# 구현 계획: [기능]

**브랜치**: `[###-feature-name]` | **날짜**: [DATE] | **명세서**: [link]
**입력**: `/specs/[###-feature-name]/spec.md`의 기능 명세서

## 실행 흐름 (/plan 명령 범위)
```
1. 입력 경로에서 기능 명세서 로드
   → 찾을 수 없으면: ERROR "경로 {path}에 기능 명세서 없음"
2. 기술 컨텍스트 작성 (명확화 필요 항목 스캔)
   → 컨텍스트에서 프로젝트 유형 감지 (web=frontend+backend, mobile=app+api, agent=core+interface)
   → 프로젝트 유형 기반 구조 결정 설정
3. 아래 헌법 체크 섹션 평가
   → 위반 사항 존재 시: 복잡성 추적에 문서화
   → 정당화 불가능 시: ERROR "먼저 접근 방식 단순화"
   → 진행 추적 업데이트: 초기 헌법 체크
4. 단계 0 실행 → research.md
   → 명확화 필요 항목 남아있으면: ERROR "미해결 항목 해결"
5. 단계 1 실행 → 계약, data-model.md, quickstart.md, 에이전트별 템플릿 파일
6. 헌법 체크 섹션 재평가
   → 새로운 위반 시: 설계 리팩터링, 단계 1로 돌아가기
   → 진행 추적 업데이트: 설계 후 헌법 체크
7. 단계 2 계획 → 작업 생성 접근 방식 설명 (tasks.md 생성하지 말 것)
8. 중지 - /tasks 명령 준비 완료
```

**중요**: /plan 명령은 7단계에서 중지합니다. 단계 2-4는 다른 명령으로 실행:
- 단계 2: /tasks 명령이 tasks.md 생성
- 단계 3-4: 구현 실행 (수동 또는 도구 사용)

## 요약
[기능 명세서에서 추출: 주요 요구사항 + 연구에서 나온 기술 접근 방식]

## 기술 컨텍스트
**언어/버전**: [예: Python 3.11, Node.js 18, Rust 1.75 또는 명확화 필요]  
**주요 종속성**: [예: FastAPI, LangChain, Transformers 또는 명확화 필요]  
**AI 모델**: [예: GPT-4, Claude-3, LLaMA-2 또는 명확화 필요]  
**저장소**: [해당 시, 예: PostgreSQL, Vector DB, 파일 또는 N/A]  
**테스트**: [예: pytest, Jest, 커스텀 또는 명확화 필요]  
**대상 플랫폼**: [예: Linux 서버, 브라우저, 모바일 또는 명확화 필요]
**프로젝트 유형**: [single/web/mobile/agent - 소스 구조 결정]  
**성능 목표**: [도메인별, 예: 1000 req/s, 10초 응답시간, 60fps 또는 명확화 필요]  
**제약사항**: [도메인별, 예: <200ms p95, <100MB 메모리, 오프라인 가능 또는 명확화 필요]  
**규모/범위**: [도메인별, 예: 10k 사용자, 1M LOC, 50개 화면 또는 명확화 필요]

## 헌법 체크
*게이트: 단계 0 연구 전에 통과해야 함. 단계 1 설계 후 재검사.*

**단순성**:
- 프로젝트 수: [#] (최대 3개 - 예: api, cli, tests)
- 프레임워크 직접 사용? (래퍼 클래스 없음)
- 단일 데이터 모델? (직렬화가 다르지 않은 한 DTO 없음)
- 패턴 회피? (검증된 필요 없이 Repository/UoW 없음)

**아키텍처**:
- 모든 기능을 에이전트로? (직접 앱 코드 없음)
- 에이전트 목록: [각각의 이름 + 목적]
- 에이전트별 CLI: [--help/--version/--format가 있는 명령]
- 에이전트 문서: llms.txt 형식 계획?

**테스트 (비협상적)**:
- RED-GREEN-Refactor 사이클 강제? (테스트가 먼저 실패해야 함)
- Git 커밋이 구현 전 테스트를 보여줌?
- 순서: Contract→Integration→E2E→Unit 엄격히 준수?
- 실제 종속성 사용? (실제 DB, 목 아님)
- 통합 테스트 대상: 새 에이전트, 계약 변경, 공유 스키마?
- 금지: 테스트 전 구현, RED 단계 건너뛰기

**관찰성**:
- 구조화된 로깅 포함?
- 프론트엔드 로그 → 백엔드? (통합 스트림)
- 충분한 오류 컨텍스트?

**버전 관리**:
- 버전 번호 할당? (MAJOR.MINOR.BUILD)
- 모든 변경 시 BUILD 증가?
- 중단적 변경 처리? (병렬 테스트, 마이그레이션 계획)

## 프로젝트 구조

### 문서 (이 기능)
```
specs/[###-feature]/
├── plan.md              # 이 파일 (/plan 명령 출력)
├── research.md          # 단계 0 출력 (/plan 명령)
├── data-model.md        # 단계 1 출력 (/plan 명령)
├── quickstart.md        # 단계 1 출력 (/plan 명령)
├── contracts/           # 단계 1 출력 (/plan 명령)
└── tasks.md             # 단계 2 출력 (/tasks 명령 - /plan에서 생성하지 않음)
```

### 소스 코드 (저장소 루트)
```
# 옵션 1: 단일 프로젝트 (기본값)
src/
├── agents/
├── models/
├── services/
├── cli/
└── lib/

tests/
├── contract/
├── integration/
└── unit/

# 옵션 2: 웹 애플리케이션 ("frontend" + "backend" 감지 시)
backend/
├── src/
│   ├── agents/
│   ├── models/
│   ├── services/
│   └── api/
└── tests/

frontend/
├── src/
│   ├── components/
│   ├── pages/
│   └── services/
└── tests/

# 옵션 3: AI 에이전트 시스템 ("agent" + "interface" 감지 시)
core/
├── src/
│   ├── agents/
│   ├── models/
│   ├── memory/
│   └── tools/
└── tests/

interface/
├── src/
│   ├── cli/
│   ├── api/
│   └── web/
└── tests/
```

**구조 결정**: [기술 컨텍스트가 web/mobile/agent 앱을 나타내지 않는 한 옵션 1을 기본값으로]

## 단계 0: 개요 & 연구
1. **위 기술 컨텍스트에서 미지수 추출**:
   - 각 명확화 필요 → 연구 작업
   - 각 종속성 → 모범 사례 작업
   - 각 통합 → 패턴 작업

2. **연구 에이전트 생성 및 배치**:
   ```
   기술 컨텍스트의 각 미지수에 대해:
     작업: "{기능 컨텍스트}에 대한 {미지수} 연구"
   각 기술 선택에 대해:
     작업: "{도메인}에서 {기술}에 대한 모범 사례 찾기"
   ```

3. **research.md에서 발견사항 통합** 형식 사용:
   - 결정: [선택된 것]
   - 근거: [선택된 이유]
   - 고려된 대안: [평가된 다른 것들]

**출력**: 모든 명확화 필요가 해결된 research.md

## 단계 1: 설계 & 계약
*전제조건: research.md 완료*

1. **기능 명세서에서 엔티티 추출** → `data-model.md`:
   - 엔티티 이름, 필드, 관계
   - 요구사항의 검증 규칙
   - 해당 시 상태 전환

2. **기능 요구사항에서 API 계약 생성**:
   - 각 사용자 행동 → 엔드포인트
   - 표준 REST/GraphQL 패턴 사용
   - `/contracts/`에 OpenAPI/GraphQL 스키마 출력

3. **계약에서 계약 테스트 생성**:
   - 엔드포인트당 하나의 테스트 파일
   - 요청/응답 스키마 검증
   - 테스트는 실패해야 함 (아직 구현 없음)

4. **사용자 스토리에서 테스트 시나리오 추출**:
   - 각 스토리 → 통합 테스트 시나리오
   - 빠른 시작 테스트 = 스토리 검증 단계

5. **에이전트 파일 점진적 업데이트** (O(1) 작업):
   - AI 어시스턴트에 대해 `/scripts/update-agent-context.sh` 실행
   - 존재 시: 현재 계획에서 새 기술만 추가
   - 마커 간 수동 추가 보존
   - 최근 변경사항 업데이트 (최근 3개 유지)
   - 토큰 효율성을 위해 150줄 미만 유지
   - 저장소 루트에 출력

**출력**: data-model.md, /contracts/*, 실패하는 테스트, quickstart.md, 에이전트별 파일

## 단계 2: 작업 계획 접근 방식
*이 섹션은 /tasks 명령이 수행할 작업을 설명 - /plan 중에 실행하지 말 것*

**작업 생성 전략**:
- `/templates/tasks-template.md`를 기본으로 로드
- 단계 1 설계 문서(계약, 데이터 모델, 빠른 시작)에서 작업 생성
- 각 계약 → 계약 테스트 작업 [P]
- 각 엔티티 → 모델 생성 작업 [P]
- 각 사용자 스토리 → 통합 테스트 작업
- 테스트 통과를 위한 구현 작업

**순서 전략**:
- TDD 순서: 구현 전 테스트
- 종속성 순서: UI 전 서비스 전 모델
- 병렬 실행을 위해 [P] 표시 (독립적 파일)

**예상 출력**: tasks.md에 25-30개의 번호 매겨진, 순서가 있는 작업

**중요**: 이 단계는 /tasks 명령으로 실행되며, /plan이 아님

## 단계 3+: 향후 구현
*/plan 명령 범위를 벗어난 단계들*

**단계 3**: 작업 실행 (/tasks 명령이 tasks.md 생성)  
**단계 4**: 구현 (헌법 원칙에 따라 tasks.md 실행)  
**단계 5**: 검증 (테스트 실행, quickstart.md 실행, 성능 검증)

## 복잡성 추적
*정당화되어야 하는 헌법 체크 위반이 있는 경우에만 작성*

| 위반 | 필요한 이유 | 더 간단한 대안이 거부된 이유 |
|-----------|------------|-------------------------------------|
| [예: 4번째 프로젝트] | [현재 필요] | [3개 프로젝트로 불충분한 이유] |
| [예: Repository 패턴] | [구체적 문제] | [직접 DB 접근이 불충분한 이유] |

## 진행 추적
*실행 흐름 중에 이 체크리스트가 업데이트됨*

**단계 상태**:
- [ ] 단계 0: 연구 완료 (/plan 명령)
- [ ] 단계 1: 설계 완료 (/plan 명령)
- [ ] 단계 2: 작업 계획 완료 (/plan 명령 - 접근 방식만 설명)
- [ ] 단계 3: 작업 생성 (/tasks 명령)
- [ ] 단계 4: 구현 완료
- [ ] 단계 5: 검증 통과

**게이트 상태**:
- [ ] 초기 헌법 체크: 통과
- [ ] 설계 후 헌법 체크: 통과
- [ ] 모든 명확화 필요 해결
- [ ] 복잡성 편차 문서화

---
*헌법 v1.0.0 기반 - `/memory/constitution.md` 참조*